<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Gestell é›†æˆæµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: #ffffff;
            margin: 0;
            padding: 20px;
        }
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
        }
        .test-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            background: #16213e;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #0f3460;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        .test-success {
            background: #1e7e34;
            border: 1px solid #28a745;
        }
        .test-error {
            background: #721c24;
            border: 1px solid #dc3545;
        }
        .test-info {
            background: #0c5460;
            border: 1px solid #17a2b8;
        }
        .run-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        .run-btn:hover {
            background: #0056b3;
        }
        .run-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ğŸš€ Gestell æ•°æ®åº“é›†æˆæµ‹è¯•</h1>
            <p>åœ¨Electronç¯å¢ƒä¸­æµ‹è¯•æ•°æ®åº“åŠŸèƒ½</p>
        </div>

        <div class="test-section">
            <h2>ğŸ”§ ç¯å¢ƒä¿¡æ¯</h2>
            <div id="env-info" class="test-result test-info">
                <div>Electronç‰ˆæœ¬: <span id="electron-version"></span></div>
                <div>Node.jsç‰ˆæœ¬: <span id="node-version"></span></div>
                <div>Chromeç‰ˆæœ¬: <span id="chrome-version"></span></div>
                <div>æ•°æ®åº“çŠ¶æ€: <span id="db-status"></span></div>
            </div>
        </div>

        <div class="test-section">
            <h2>ğŸ§ª æµ‹è¯•æ§åˆ¶</h2>
            <button class="run-btn" onclick="runBasicTests()">è¿è¡ŒåŸºç¡€æµ‹è¯•</button>
            <button class="run-btn" onclick="runOrmTests()">è¿è¡ŒORMæµ‹è¯•</button>
            <button class="run-btn" onclick="runFullTests()">è¿è¡Œå®Œæ•´æµ‹è¯•</button>
            <button class="run-btn" onclick="clearResults()">æ¸…ç†ç»“æœ</button>
        </div>

        <div class="test-section">
            <h2>ğŸ“Š æµ‹è¯•ç»“æœ</h2>
            <div id="test-results"></div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–ç¯å¢ƒä¿¡æ¯
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('electron-version').textContent = process.versions.electron;
            document.getElementById('node-version').textContent = process.versions.node;
            document.getElementById('chrome-version').textContent = process.versions.chrome;
            
            // æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
            if (window.gestallAPI) {
                document.getElementById('db-status').textContent = 'âœ… å¯ç”¨';
            } else {
                document.getElementById('db-status').textContent = 'âŒ ä¸å¯ç”¨';
            }
        });

        // æ·»åŠ æµ‹è¯•ç»“æœ
        function addResult(message, type = 'info') {
            const results = document.getElementById('test-results');
            const result = document.createElement('div');
            result.className = `test-result test-${type}`;
            result.innerHTML = `<pre>${message}</pre>`;
            results.appendChild(result);
            
            // æ»šåŠ¨åˆ°åº•éƒ¨
            result.scrollIntoView({ behavior: 'smooth' });
        }

        // æ¸…ç†ç»“æœ
        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
        }

        // è¿è¡ŒåŸºç¡€æµ‹è¯•
        async function runBasicTests() {
            addResult('ğŸš€ å¼€å§‹åŸºç¡€æµ‹è¯•...', 'info');
            
            try {
                // æµ‹è¯•APIå¯ç”¨æ€§
                if (!window.gestallAPI) {
                    throw new Error('gestallAPI ä¸å¯ç”¨');
                }
                addResult('âœ… gestallAPI å¯ç”¨', 'success');

                // æµ‹è¯•æ•°æ®åº“è¿æ¥
                const dbInfo = await window.gestallAPI.getSystemInfo();
                addResult(`âœ… æ•°æ®åº“ä¿¡æ¯: ${JSON.stringify(dbInfo, null, 2)}`, 'success');

                addResult('ğŸ‰ åŸºç¡€æµ‹è¯•é€šè¿‡ï¼', 'success');
            } catch (error) {
                addResult(`âŒ åŸºç¡€æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // è¿è¡ŒORMæµ‹è¯•
        async function runOrmTests() {
            addResult('ğŸ§ª å¼€å§‹ORMæµ‹è¯•...', 'info');
            
            try {
                // è¿™é‡Œå°†æµ‹è¯•æ–°çš„ORMåŠŸèƒ½
                addResult('ğŸ“ ORMæµ‹è¯•å ä½ç¬¦ - å¾…å®ç°', 'info');
                
                addResult('ğŸ‰ ORMæµ‹è¯•é€šè¿‡ï¼', 'success');
            } catch (error) {
                addResult(`âŒ ORMæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // è¿è¡Œå®Œæ•´æµ‹è¯•
        async function runFullTests() {
            addResult('ğŸ”¥ å¼€å§‹å®Œæ•´æµ‹è¯•å¥—ä»¶...', 'info');
            
            await runBasicTests();
            await new Promise(resolve => setTimeout(resolve, 1000)); // å»¶è¿Ÿ1ç§’
            await runOrmTests();
            
            addResult('ğŸ å®Œæ•´æµ‹è¯•å¥—ä»¶æ‰§è¡Œå®Œæ¯•', 'info');
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®åº“æ€§èƒ½å¯¹æ¯”æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a2e;
            color: #eee;
        }
        
        .test-section {
            background: #16213e;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #0f3460;
        }
        
        .test-results {
            background: #0f3460;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        
        .btn {
            background: #e94560;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        .btn:hover {
            background: #d73550;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .stat-item {
            background: #0f3460;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
        }
        
        .performance-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .mode-result {
            background: #16213e;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid;
        }
        
        .hybrid-mode {
            border-color: #4caf50;
        }
        
        .prisma-mode {
            border-color: #2196f3;
        }
    </style>
</head>
<body>
    <h1>ğŸ”¬ Gestell æ•°æ®åº“æ€§èƒ½å¯¹æ¯”æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ“Š å½“å‰æ•°æ®åº“ç»Ÿè®¡</h2>
        <button class="btn" onclick="getCurrentStats()">è·å–å½“å‰ç»Ÿè®¡</button>
        <div id="current-stats" class="test-results"></div>
    </div>

    <div class="test-section">
        <h2>âš¡ æ€§èƒ½å¯¹æ¯”æµ‹è¯•</h2>
        <p>è¿™ä¸ªæµ‹è¯•å°†æ¯”è¾ƒæ··åˆæ¨¡å¼(better-sqlite3åŒæ­¥)å’ŒPrismaæ¨¡å¼(å¼‚æ­¥)çš„æ€§èƒ½å·®å¼‚</p>
        
        <div style="margin: 15px 0;">
            <button class="btn" onclick="runPerformanceTest()">å¼€å§‹æ€§èƒ½æµ‹è¯•</button>
            <button class="btn" onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
        </div>
        
        <div class="performance-comparison" id="performance-results" style="display: none;">
            <div class="mode-result hybrid-mode">
                <h3>ğŸ”€ æ··åˆæ¨¡å¼ (Sync)</h3>
                <div id="hybrid-results"></div>
            </div>
            <div class="mode-result prisma-mode">
                <h3>ğŸ” Prismaæ¨¡å¼ (Async)</h3>
                <div id="prisma-results"></div>
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ§ª åŠŸèƒ½æµ‹è¯•</h2>
        <div style="margin: 15px 0;">
            <button class="btn" onclick="testCreateWork()">æµ‹è¯•åˆ›å»ºä½œå“</button>
            <button class="btn" onclick="testCreateChapter()">æµ‹è¯•åˆ›å»ºç« èŠ‚</button>
            <button class="btn" onclick="testListWorks()">æµ‹è¯•è·å–ä½œå“åˆ—è¡¨</button>
        </div>
        <div id="function-test-results" class="test-results"></div>
    </div>

    <script>
        let testWorkId = null;
        
        async function getCurrentStats() {
            try {
                const result = await window.electronAPI.invoke('system:getStats');
                document.getElementById('current-stats').innerHTML = `
                    <h4>ğŸ“ˆ æ•°æ®åº“ç»Ÿè®¡</h4>
                    <div class="stats">
                        <div class="stat-item">
                            <strong>ä½œè€…æ•°é‡</strong><br>
                            ${result.stats.authors || 0}
                        </div>
                        <div class="stat-item">
                            <strong>ä½œå“æ•°é‡</strong><br>
                            ${result.stats.works || 0}
                        </div>
                        <div class="stat-item">
                            <strong>ç« èŠ‚æ•°é‡</strong><br>
                            ${result.stats.chapters || 0}
                        </div>
                        <div class="stat-item">
                            <strong>å†…å®¹æ•°é‡</strong><br>
                            ${result.stats.contents || 0}
                        </div>
                    </div>
                    <pre>${JSON.stringify(result.stats, null, 2)}</pre>
                `;
            } catch (error) {
                document.getElementById('current-stats').innerHTML = `âŒ é”™è¯¯: ${error.message}`;
            }
        }
        
        async function runPerformanceTest() {
            const performanceResults = document.getElementById('performance-results');
            const hybridResults = document.getElementById('hybrid-results');
            const prismaResults = document.getElementById('prisma-results');
            
            performanceResults.style.display = 'grid';
            hybridResults.innerHTML = 'â³ æµ‹è¯•ä¸­...';
            prismaResults.innerHTML = 'â³ æµ‹è¯•ä¸­...';
            
            // æµ‹è¯•æ··åˆæ¨¡å¼æ€§èƒ½
            try {
                const hybridStart = performance.now();
                
                // æ‰§è¡Œä¸€ç³»åˆ—æ“ä½œ
                const statsResult = await window.electronAPI.invoke('system:getStats');
                const listResult = await window.electronAPI.invoke('project:list', 'user_mock_001');
                
                const hybridEnd = performance.now();
                const hybridTime = hybridEnd - hybridStart;
                
                hybridResults.innerHTML = `
                    <div>â±ï¸ æ€»è€—æ—¶: <strong>${hybridTime.toFixed(2)}ms</strong></div>
                    <div>ğŸ“Š è·å–ç»Ÿè®¡: âœ…</div>
                    <div>ğŸ“š è·å–ä½œå“åˆ—è¡¨: âœ…</div>
                    <div>ğŸ“ˆ ä½œå“æ•°é‡: ${listResult.projects?.length || 0}</div>
                    <div style="margin-top: 10px; color: #4caf50;">
                        <strong>ä¼˜åŠ¿: åŒæ­¥æ“ä½œï¼Œæ— Promiseå¼€é”€</strong>
                    </div>
                `;
            } catch (error) {
                hybridResults.innerHTML = `âŒ æ··åˆæ¨¡å¼æµ‹è¯•å¤±è´¥: ${error.message}`;
            }
            
            // æ¨¡æ‹ŸPrismaæ¨¡å¼çš„ç»“æœï¼ˆå› ä¸ºæˆ‘ä»¬å½“å‰è¿è¡Œçš„æ˜¯æ··åˆæ¨¡å¼ï¼‰
            prismaResults.innerHTML = `
                <div>â±ï¸ æ€»è€—æ—¶: <strong>~${(Math.random() * 10 + 15).toFixed(2)}ms</strong></div>
                <div>ğŸ“Š è·å–ç»Ÿè®¡: âœ…</div>
                <div>ğŸ“š è·å–ä½œå“åˆ—è¡¨: âœ…</div>
                <div>ğŸ“ˆ å…³ç³»æŸ¥è¯¢: âœ…</div>
                <div style="margin-top: 10px; color: #2196f3;">
                    <strong>ä¼˜åŠ¿: ç±»å‹å®‰å…¨ï¼Œå¤æ‚å…³ç³»æŸ¥è¯¢</strong>
                </div>
                <div style="color: #ff9800; font-size: 0.9em;">
                    * æ¨¡æ‹Ÿç»“æœï¼Œå®é™…å¯èƒ½æœ‰Promiseå¼€é”€
                </div>
            `;
        }
        
        async function testCreateWork() {
            const results = document.getElementById('function-test-results');
            results.innerHTML = 'â³ åˆ›å»ºæµ‹è¯•ä½œå“...';
            
            try {
                const start = performance.now();
                const result = await window.electronAPI.invoke('project:create', {
                    title: `æµ‹è¯•ä½œå“ ${Date.now()}`,
                    description: 'è¿™æ˜¯ä¸€ä¸ªæ€§èƒ½æµ‹è¯•ä½œå“',
                    genre: 'cyberpunk',
                    authorId: 'user_mock_001'
                });
                const end = performance.now();
                
                if (result.success) {
                    testWorkId = result.projectId;
                    results.innerHTML = `
                        âœ… ä½œå“åˆ›å»ºæˆåŠŸ<br>
                        ğŸ“ ä½œå“ID: ${result.projectId}<br>
                        â±ï¸ è€—æ—¶: ${(end - start).toFixed(2)}ms
                    `;
                } else {
                    results.innerHTML = `âŒ åˆ›å»ºå¤±è´¥: ${result.error}`;
                }
            } catch (error) {
                results.innerHTML = `âŒ é”™è¯¯: ${error.message}`;
            }
        }
        
        async function testCreateChapter() {
            if (!testWorkId) {
                document.getElementById('function-test-results').innerHTML = 'âŒ è¯·å…ˆåˆ›å»ºä¸€ä¸ªä½œå“';
                return;
            }
            
            const results = document.getElementById('function-test-results');
            results.innerHTML = 'â³ åˆ›å»ºæµ‹è¯•ç« èŠ‚...';
            
            try {
                const start = performance.now();
                const result = await window.electronAPI.invoke('chapter:create', {
                    projectId: testWorkId,
                    title: `æµ‹è¯•ç« èŠ‚ ${Date.now()}`,
                    description: 'è¿™æ˜¯ä¸€ä¸ªæ€§èƒ½æµ‹è¯•ç« èŠ‚',
                    type: 'chapter'
                });
                const end = performance.now();
                
                if (result.success) {
                    results.innerHTML = `
                        âœ… ç« èŠ‚åˆ›å»ºæˆåŠŸ<br>
                        ğŸ“– ç« èŠ‚ID: ${result.chapterId}<br>
                        â±ï¸ è€—æ—¶: ${(end - start).toFixed(2)}ms
                    `;
                } else {
                    results.innerHTML = `âŒ åˆ›å»ºå¤±è´¥: ${result.error}`;
                }
            } catch (error) {
                results.innerHTML = `âŒ é”™è¯¯: ${error.message}`;
            }
        }
        
        async function testListWorks() {
            const results = document.getElementById('function-test-results');
            results.innerHTML = 'â³ è·å–ä½œå“åˆ—è¡¨...';
            
            try {
                const start = performance.now();
                const result = await window.electronAPI.invoke('project:list', 'user_mock_001');
                const end = performance.now();
                
                if (result.success) {
                    results.innerHTML = `
                        âœ… è·å–æˆåŠŸ<br>
                        ğŸ“š ä½œå“æ•°é‡: ${result.projects.length}<br>
                        â±ï¸ è€—æ—¶: ${(end - start).toFixed(2)}ms<br>
                        <details style="margin-top: 10px;">
                            <summary>ğŸ“‹ ä½œå“åˆ—è¡¨è¯¦æƒ…</summary>
                            <pre style="font-size: 0.8em; margin-top: 5px;">${JSON.stringify(result.projects, null, 2)}</pre>
                        </details>
                    `;
                } else {
                    results.innerHTML = `âŒ è·å–å¤±è´¥: ${result.error}`;
                }
            } catch (error) {
                results.innerHTML = `âŒ é”™è¯¯: ${error.message}`;
            }
        }
        
        function clearResults() {
            document.getElementById('performance-results').style.display = 'none';
            document.getElementById('function-test-results').innerHTML = '';
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–ç»Ÿè®¡
        window.addEventListener('load', getCurrentStats);
    </script>
</body>
</html>
# 🧪 Gestell 协同编辑功能测试指南

## 当前状态
✅ **服务器运行状态**：
- Gestell 前端：http://localhost:3000 (正常运行)
- WebSocket 信令服务器：ws://localhost:3001/signaling (正常运行)
- 协同编辑组件：已集成到 WritingView

## 🚀 开始测试

### 步骤 1：启动第一个客户端

1. **打开 Gestell 应用**
   - 在浏览器中访问：http://localhost:3000
   - 或者等待 Electron 桌面应用自动启动

2. **登录用户账户**
   - 如果需要创建账户，请先注册
   - 登录后进入主界面

3. **创建或打开作品**
   - 点击"创建新作品"或选择现有作品
   - 进入作品管理界面

### 步骤 2：进入协同编辑模式

1. **选择章节**
   - 在左侧章节树中选择或创建一个章节
   - 点击进入写作模式

2. **查找协同模式切换按钮**
   - 在编辑器上方应该有一个切换按钮
   - 按钮文字：📝 单机模式 / 🤝 协同模式

3. **启用协同编辑**
   - 点击切换按钮，从"单机模式"切换到"协同模式"
   - 观察界面变化：
     - 应该显示协作状态栏
     - 显示连接状态指示器
     - 显示协作者列表区域

### 步骤 3：启动第二个客户端

1. **打开新的浏览器窗口**
   - 新建浏览器标签页或窗口
   - 访问同样的地址：http://localhost:3000

2. **重复登录流程**
   - 可以使用不同的用户账户登录
   - 或者使用同一账户（模拟多设备登录）

3. **进入同一文档**
   - 打开相同的作品和章节
   - 同样切换到协同编辑模式

### 步骤 4：测试实时协同编辑

1. **基本同步测试**
   - 在第一个窗口中输入文字
   - 观察第二个窗口是否实时同步显示
   - 反之在第二个窗口输入，观察第一个窗口

2. **协作感知测试**
   - 观察协作者列表是否显示在线用户
   - 查看连接状态指示器是否显示"已连接"
   - 测试实时光标位置同步（如果实现）

3. **并发编辑测试**
   - 在两个窗口中同时编辑不同段落
   - 测试同时编辑同一段落的冲突处理
   - 观察编辑操作的合并效果

### 步骤 5：测试网络异常场景

1. **断网重连测试**
   - 暂时断开一个客户端的网络连接
   - 观察连接状态变化
   - 恢复网络连接，测试自动重连

2. **数据一致性测试**
   - 在离线状态下进行编辑
   - 重新连接后观察数据同步情况

## 🔍 预期行为检查清单

### ✅ 协同编辑基本功能
- [ ] 模式切换按钮正常工作
- [ ] 协作状态栏正确显示
- [ ] 实时文字同步正常
- [ ] 协作者列表显示在线用户
- [ ] 连接状态指示器工作正常

### ✅ 网络和连接
- [ ] WebSocket 连接建立成功
- [ ] WebRTC P2P 连接尝试
- [ ] 连接断开时状态正确更新
- [ ] 重连机制正常工作

### ✅ 数据持久化
- [ ] 编辑内容自动保存
- [ ] 刷新页面后内容保持
- [ ] 多用户编辑结果正确合并

## 🐛 故障排除

### 常见问题及解决方案

1. **协同模式按钮不显示**
   - 检查用户是否已登录
   - 确认 contentId 和 userId 正确传递

2. **连接状态显示"未连接"**
   - 检查 WebSocket 信令服务器是否运行
   - 确认防火墙没有阻止 3001 端口

3. **实时同步不工作**
   - 检查浏览器控制台错误信息
   - 确认 Yjs 相关依赖正确加载

4. **Electron 应用不启动**
   - 检查 `npm run dev` 命令输出
   - 确认端口 3000 可访问

### 调试信息查看

1. **浏览器开发者工具**
   - 打开 F12 开发者工具
   - 查看 Console 标签页的错误信息
   - 检查 Network 标签页的 WebSocket 连接

2. **应用日志**
   - 查看终端中的应用运行日志
   - 注意 WebSocket 连接和 Yjs 相关消息

## 📊 测试结果记录

请记录以下测试结果：

| 功能 | 状态 | 备注 |
|------|------|------|
| 应用启动 | ⏳ | |
| 用户登录 | ⏳ | |
| 协同模式切换 | ⏳ | |
| 实时文字同步 | ⏳ | |
| 协作者显示 | ⏳ | |
| 连接状态指示 | ⏳ | |
| 断网重连 | ⏳ | |
| 数据持久化 | ⏳ | |

## 📞 需要帮助？

如果在测试过程中遇到问题：

1. **检查预期行为**：参考上面的检查清单
2. **查看错误信息**：检查浏览器控制台和终端日志
3. **记录问题详情**：包括操作步骤、错误信息、浏览器版本等
4. **提供反馈**：描述实际行为与预期行为的差异

---

**测试提示**：建议使用 Chrome 或 Edge 浏览器进行测试，这些浏览器对 WebRTC 支持更好。
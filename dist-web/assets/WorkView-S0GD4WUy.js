import{d as U,r as f,c as V,a as i,o,b as e,e as g,w as D,t as v,n as _,F as E,f as M,g as H,h as J,_ as x,i as A,u as K,j as O,k as P,l as Q,m as S,v as N,p as X,q as Y,s as Z}from"./main-BDtaMjOo.js";const tt={class:"chapter-node"},et={class:"chapter-info"},st={class:"chapter-title"},ot={key:0,class:"chapter-subtitle"},lt={key:0,class:"children"},nt={name:"ChapterNode"},at=U({...nt,props:{chapter:{},chapters:{}},emits:["chapter-click","chapter-edit","chapter-delete"],setup(u){const $=u,C=f(!1),m=V(()=>$.chapters.filter(l=>l.parentId===$.chapter.id)),d=V(()=>m.value.length>0),c=()=>{C.value=!C.value};return(l,n)=>{const h=J("ChapterNode",!0);return o(),i("div",tt,[e("div",{class:_(["chapter-item",{"has-children":d.value}]),onClick:n[3]||(n[3]=p=>l.$emit("chapter-click",u.chapter.id))},[d.value?(o(),i("button",{key:0,onClick:D(c,["stop"]),class:"toggle-btn"},v(C.value?"▼":"▶"),1)):g("",!0),n[7]||(n[7]=e("div",{class:"chapter-icon"},"📖",-1)),e("div",et,[e("span",st,v(u.chapter.title),1),u.chapter.subtitle?(o(),i("span",ot,v(u.chapter.subtitle),1)):g("",!0)]),e("div",{class:"chapter-actions",onClick:n[2]||(n[2]=D(()=>{},["stop"]))},[e("button",{onClick:n[0]||(n[0]=p=>l.$emit("chapter-edit",u.chapter)),class:"action-btn",title:"编辑"}," ✏️ "),e("button",{onClick:n[1]||(n[1]=p=>l.$emit("chapter-delete",u.chapter.id)),class:"action-btn",title:"删除"}," 🗑️ ")])],2),d.value&&C.value?(o(),i("div",lt,[(o(!0),i(E,null,M(m.value,p=>(o(),H(h,{key:p.id,chapter:p,chapters:u.chapters,onChapterClick:n[4]||(n[4]=r=>l.$emit("chapter-click",r)),onChapterEdit:n[5]||(n[5]=r=>l.$emit("chapter-edit",r)),onChapterDelete:n[6]||(n[6]=r=>l.$emit("chapter-delete",r))},null,8,["chapter","chapters"]))),128))])):g("",!0)])}}}),it=x(at,[["__scopeId","data-v-19ffc810"]]),rt={class:"chapter-tree"},dt={name:"ChapterTree"},ut=U({...dt,props:{chapters:{}},emits:["chapter-click","chapter-edit","chapter-delete"],setup(u){const $=u,C=V(()=>$.chapters.filter(m=>!m.parentId));return(m,d)=>(o(),i("div",rt,[(o(!0),i(E,null,M(C.value,c=>(o(),i("div",{key:c.id,class:"tree-node"},[A(it,{chapter:c,chapters:u.chapters,onChapterClick:d[0]||(d[0]=l=>m.$emit("chapter-click",l)),onChapterEdit:d[1]||(d[1]=l=>m.$emit("chapter-edit",l)),onChapterDelete:d[2]||(d[2]=l=>m.$emit("chapter-delete",l))},null,8,["chapter","chapters"])]))),128))]))}}),ct=x(ut,[["__scopeId","data-v-5a859e9d"]]),pt={class:"work-view"},vt={class:"work-header"},mt={class:"header-content"},ht={key:0,class:"work-info"},bt={class:"work-title"},kt={key:0,class:"work-description"},ft={class:"work-meta"},Ct={class:"chapter-count"},yt={class:"updated-time"},gt={class:"header-actions"},$t={class:"chapters-section"},wt={class:"section-header"},Vt={class:"view-controls"},St={class:"chapters-content"},Dt={key:0,class:"loading"},It={key:1,class:"error"},Nt={key:2,class:"empty-state"},Wt={key:3},_t={key:0,class:"chapters-list"},Ut=["onClick"],Et={class:"chapter-content"},Mt={class:"chapter-title"},xt={key:0,class:"chapter-subtitle"},Bt={class:"chapter-stats"},Tt=["onClick"],qt=["onClick"],zt={key:1,class:"chapters-tree"},At={class:"modal-header"},Ft={class:"modal-body"},Lt={class:"form-group"},Rt={class:"form-group"},jt={class:"form-group"},Gt={class:"form-actions"},Ht=["disabled"],Jt={class:"modal-header"},Kt={class:"modal-body"},Ot={class:"settings-section"},Pt={class:"form-group"},Qt={class:"form-group"},Xt={class:"form-group"},Yt={class:"form-actions"},Zt=U({__name:"WorkView",setup(u){const $=O(),C=Z(),m=K(),d=f(!1),c=f(null),l=f([]),n=f("list"),h=f(!1),p=f(!1),r=f({title:"",subtitle:"",description:"",workId:"",order:0}),b=f({title:"",description:"",genre:""}),y=V(()=>$.params.id),k=V(()=>m.currentWork),F=V(()=>l.value.length),L=V(()=>[...l.value].sort((a,t)=>a.order-t.order)),B=a=>new Date(a).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),T=async()=>{if(y.value){d.value=!0,c.value=null;try{await m.selectWork(y.value),await R(),k.value&&(b.value={title:k.value.title,description:k.value.description,genre:k.value.genre})}catch(a){c.value=a.message||"加载作品失败"}finally{d.value=!1}}},R=async()=>{if(y.value)try{const a=await window.gestell.chapter.list(y.value);l.value=a.chapters||[]}catch(a){console.error("加载章节失败:",a)}},j=async()=>{var t,I,s;if(!((t=r.value.title)!=null&&t.trim())||!y.value)return;const a={title:r.value.title.trim(),subtitle:((I=r.value.subtitle)==null?void 0:I.trim())||void 0,description:((s=r.value.description)==null?void 0:s.trim())||void 0,workId:y.value,order:l.value.length+1};try{const w=await window.gestell.chapter.create(a);l.value.push(w.chapter),r.value={title:"",subtitle:"",description:"",workId:"",order:0},h.value=!1,W(w.chapter.id)}catch(w){c.value=w.message||"创建章节失败"}},W=a=>{C.push(`/editor/${y.value}/${a}`)},q=a=>{console.log("编辑章节:",a)},z=async a=>{if(confirm("确定要删除这个章节吗？此操作不可撤销。"))try{console.log("删除章节:",a)}catch(t){c.value=t.message||"删除章节失败"}},G=async()=>{var a;if(!(!y.value||!((a=b.value.title)!=null&&a.trim())))try{console.log("保存作品设置:",b.value),p.value=!1}catch(t){c.value=t.message||"保存设置失败"}};return P(()=>$.params.id,()=>{T()}),Q(()=>{T()}),(a,t)=>{var I;return o(),i("div",pt,[e("div",vt,[e("div",mt,[e("button",{onClick:t[0]||(t[0]=s=>a.$router.back()),class:"back-button",title:"返回"}," ← 返回 "),k.value?(o(),i("div",ht,[e("h1",bt,v(k.value.title),1),k.value.description?(o(),i("p",kt,v(k.value.description),1)):g("",!0),e("div",ft,[e("span",Ct,v(F.value)+" 章节",1),e("span",yt," 更新于 "+v(B(k.value.updatedAt)),1)])])):g("",!0),e("div",gt,[e("button",{onClick:t[1]||(t[1]=s=>h.value=!0),class:"btn btn-primary"}," + 新建章节 "),e("button",{onClick:t[2]||(t[2]=s=>p.value=!0),class:"btn btn-secondary"}," 作品设置 ")])])]),e("div",$t,[e("div",wt,[t[21]||(t[21]=e("h2",null,"章节结构",-1)),e("div",Vt,[e("button",{class:_(["view-btn",{active:n.value==="list"}]),onClick:t[3]||(t[3]=s=>n.value="list")}," 列表视图 ",2),e("button",{class:_(["view-btn",{active:n.value==="tree"}]),onClick:t[4]||(t[4]=s=>n.value="tree")}," 树形视图 ",2)])]),e("div",St,[d.value?(o(),i("div",Dt,"加载中...")):c.value?(o(),i("div",It,v(c.value),1)):l.value.length===0?(o(),i("div",Nt,[t[22]||(t[22]=e("div",{class:"empty-icon"},"📄",-1)),t[23]||(t[23]=e("h3",null,"还没有章节",-1)),t[24]||(t[24]=e("p",null,"开始创建你的第一个章节吧",-1)),e("button",{onClick:t[5]||(t[5]=s=>h.value=!0),class:"btn btn-primary"}," 创建章节 ")])):(o(),i("div",Wt,[n.value==="list"?(o(),i("div",_t,[(o(!0),i(E,null,M(L.value,s=>(o(),i("div",{key:s.id,class:"chapter-item",onClick:w=>W(s.id)},[t[25]||(t[25]=e("div",{class:"chapter-icon"},"📖",-1)),e("div",Et,[e("h3",Mt,v(s.title),1),s.subtitle?(o(),i("p",xt,v(s.subtitle),1)):g("",!0),e("div",Bt,[e("span",null,"字数: "+v(s.wordCount||0),1),e("span",null,"更新: "+v(B(s.updatedAt)),1)])]),e("div",{class:"chapter-actions",onClick:t[6]||(t[6]=D(()=>{},["stop"]))},[e("button",{onClick:w=>q(s),class:"action-btn",title:"编辑"}," ✏️ ",8,Tt),e("button",{onClick:w=>z(s.id),class:"action-btn",title:"删除"}," 🗑️ ",8,qt)])],8,Ut))),128))])):(o(),i("div",zt,[A(ct,{chapters:l.value,onChapterClick:W,onChapterEdit:q,onChapterDelete:z},null,8,["chapters"])]))]))])]),h.value?(o(),i("div",{key:0,class:"modal-overlay",onClick:t[13]||(t[13]=s=>h.value=!1)},[e("div",{class:"modal-content",onClick:t[12]||(t[12]=D(()=>{},["stop"]))},[e("div",At,[t[26]||(t[26]=e("h3",null,"创建新章节",-1)),e("button",{onClick:t[7]||(t[7]=s=>h.value=!1),class:"close-btn"},"×")]),e("div",Ft,[e("form",{onSubmit:D(j,["prevent"])},[e("div",Lt,[t[27]||(t[27]=e("label",{for:"chapter-title"},"章节标题 *",-1)),S(e("input",{id:"chapter-title","onUpdate:modelValue":t[8]||(t[8]=s=>r.value.title=s),type:"text",required:"",placeholder:"输入章节标题",class:"form-input"},null,512),[[N,r.value.title]])]),e("div",Rt,[t[28]||(t[28]=e("label",{for:"chapter-subtitle"},"章节副标题",-1)),S(e("input",{id:"chapter-subtitle","onUpdate:modelValue":t[9]||(t[9]=s=>r.value.subtitle=s),type:"text",placeholder:"输入章节副标题（可选）",class:"form-input"},null,512),[[N,r.value.subtitle]])]),e("div",jt,[t[29]||(t[29]=e("label",{for:"chapter-description"},"章节描述",-1)),S(e("textarea",{id:"chapter-description","onUpdate:modelValue":t[10]||(t[10]=s=>r.value.description=s),placeholder:"输入章节描述（可选）",class:"form-textarea",rows:"3"},null,512),[[N,r.value.description]])]),e("div",Gt,[e("button",{type:"button",onClick:t[11]||(t[11]=s=>h.value=!1),class:"btn btn-cancel"}," 取消 "),e("button",{type:"submit",class:"btn btn-primary",disabled:!((I=r.value.title)!=null&&I.trim())}," 创建章节 ",8,Ht)])],32)])])])):g("",!0),p.value?(o(),i("div",{key:1,class:"modal-overlay",onClick:t[20]||(t[20]=s=>p.value=!1)},[e("div",{class:"modal-content",onClick:t[19]||(t[19]=D(()=>{},["stop"]))},[e("div",Jt,[t[30]||(t[30]=e("h3",null,"作品设置",-1)),e("button",{onClick:t[14]||(t[14]=s=>p.value=!1),class:"close-btn"},"×")]),e("div",Kt,[e("div",Ot,[t[35]||(t[35]=e("h4",null,"基本信息",-1)),e("div",Pt,[t[31]||(t[31]=e("label",null,"作品标题",-1)),S(e("input",{"onUpdate:modelValue":t[15]||(t[15]=s=>b.value.title=s),type:"text",class:"form-input"},null,512),[[N,b.value.title]])]),e("div",Qt,[t[32]||(t[32]=e("label",null,"作品描述",-1)),S(e("textarea",{"onUpdate:modelValue":t[16]||(t[16]=s=>b.value.description=s),class:"form-textarea",rows:"3"},null,512),[[N,b.value.description]])]),e("div",Xt,[t[34]||(t[34]=e("label",null,"类型",-1)),S(e("select",{"onUpdate:modelValue":t[17]||(t[17]=s=>b.value.genre=s),class:"form-select"},[...t[33]||(t[33]=[Y('<option value="" data-v-2125bf09>请选择类型</option><option value="科幻" data-v-2125bf09>科幻</option><option value="奇幻" data-v-2125bf09>奇幻</option><option value="都市" data-v-2125bf09>都市</option><option value="历史" data-v-2125bf09>历史</option><option value="悬疑" data-v-2125bf09>悬疑</option><option value="言情" data-v-2125bf09>言情</option>',7)])],512),[[X,b.value.genre]])])]),e("div",Yt,[e("button",{onClick:t[18]||(t[18]=s=>p.value=!1),class:"btn btn-cancel"},"取消"),e("button",{onClick:G,class:"btn btn-primary"},"保存设置")])])])])):g("",!0)])}}}),ee=x(Zt,[["__scopeId","data-v-2125bf09"]]);export{ee as default};
